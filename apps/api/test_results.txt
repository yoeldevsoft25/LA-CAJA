
> @la-caja/api@1.0.0 test
> jest src/inventory/escrow/inventory-escrow.integration.spec.ts --testPathIgnorePatterns=NONE --detectOpenHandles --forceExit

[31m[Nest] 11076  - [39m02/06/2026, 4:40:01 PM [31m  ERROR[39m [38;5;3m[TypeOrmModule] [39m[31mUnable to connect to the database. Retrying (1)...[39m
TypeORMError: Entity metadata for Product#ingredients was not found. Check if you specified a correct entity object and if it's connected in the connection options.
    at /Users/yoeldev/Documents/GitHub/LA-CAJA/src/metadata-builder/EntityMetadataBuilder.ts:1128:23
    at Array.forEach (<anonymous>)
    at EntityMetadataBuilder.computeInverseProperties (/Users/yoeldev/Documents/GitHub/LA-CAJA/src/metadata-builder/EntityMetadataBuilder.ts:1118:34)
    at /Users/yoeldev/Documents/GitHub/LA-CAJA/src/metadata-builder/EntityMetadataBuilder.ts:160:18
    at Array.forEach (<anonymous>)
    at EntityMetadataBuilder.build (/Users/yoeldev/Documents/GitHub/LA-CAJA/src/metadata-builder/EntityMetadataBuilder.ts:159:25)
    at ConnectionMetadataBuilder.buildEntityMetadatas (/Users/yoeldev/Documents/GitHub/LA-CAJA/src/connection/ConnectionMetadataBuilder.ts:106:11)
    at DataSource.buildMetadatas (/Users/yoeldev/Documents/GitHub/LA-CAJA/src/data-source/DataSource.ts:733:13)
    at DataSource.initialize (/Users/yoeldev/Documents/GitHub/LA-CAJA/src/data-source/DataSource.ts:264:13)
[31m[Nest] 11076  - [39m02/06/2026, 4:40:04 PM [31m  ERROR[39m [38;5;3m[TypeOrmModule] [39m[31mUnable to connect to the database. Retrying (2)...[39m
TypeORMError: Entity metadata for Product#ingredients was not found. Check if you specified a correct entity object and if it's connected in the connection options.
    at /Users/yoeldev/Documents/GitHub/LA-CAJA/src/metadata-builder/EntityMetadataBuilder.ts:1128:23
    at Array.forEach (<anonymous>)
    at EntityMetadataBuilder.computeInverseProperties (/Users/yoeldev/Documents/GitHub/LA-CAJA/src/metadata-builder/EntityMetadataBuilder.ts:1118:34)
    at /Users/yoeldev/Documents/GitHub/LA-CAJA/src/metadata-builder/EntityMetadataBuilder.ts:160:18
    at Array.forEach (<anonymous>)
    at EntityMetadataBuilder.build (/Users/yoeldev/Documents/GitHub/LA-CAJA/src/metadata-builder/EntityMetadataBuilder.ts:159:25)
    at ConnectionMetadataBuilder.buildEntityMetadatas (/Users/yoeldev/Documents/GitHub/LA-CAJA/src/connection/ConnectionMetadataBuilder.ts:106:11)
    at DataSource.buildMetadatas (/Users/yoeldev/Documents/GitHub/LA-CAJA/src/data-source/DataSource.ts:733:13)
    at DataSource.initialize (/Users/yoeldev/Documents/GitHub/LA-CAJA/src/data-source/DataSource.ts:264:13)
FAIL src/inventory/escrow/inventory-escrow.integration.spec.ts (14.643 s)
  â— Stock Convergence Integration (Offline -> Sync -> Projections) â€º should correctly balance stock between warehouse and escrow after multiple sales

    thrown: "Exceeded timeout of 5000 ms for a hook.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      52 |     let deviceId: string;
      53 |
    > 54 |     beforeAll(async () => {
         |     ^
      55 |         // Patch Entities for Sqlite
      56 |         const columns = getMetadataArgsStorage().columns;
      57 |         columns.forEach(col => {

      at inventory/escrow/inventory-escrow.integration.spec.ts:54:5
      at Object.<anonymous> (inventory/escrow/inventory-escrow.integration.spec.ts:46:1)


  â— Test suite failed to run

    TypeError: Cannot read properties of undefined (reading 'close')

      114 |
      115 |     afterAll(async () => {
    > 116 |         await moduleFixture.close();
          |                             ^
      117 |     });
      118 |
      119 |     it('should correctly balance stock between warehouse and escrow after multiple sales', async () => {

      at Object.<anonymous> (inventory/escrow/inventory-escrow.integration.spec.ts:116:29)

Test Suites: 1 failed, 1 total
Tests:       1 failed, 1 total
Snapshots:   0 total
Time:        15.34 s
Ran all test suites matching /src\/inventory\/escrow\/inventory-escrow.integration.spec.ts/i.
npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path /Users/yoeldev/Documents/GitHub/LA-CAJA/apps/api
npm error workspace @la-caja/api@1.0.0
npm error location /Users/yoeldev/Documents/GitHub/LA-CAJA/apps/api
npm error command failed
npm error command sh -c jest src/inventory/escrow/inventory-escrow.integration.spec.ts --testPathIgnorePatterns=NONE --detectOpenHandles --forceExit
